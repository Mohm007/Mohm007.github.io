<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="permissions-policy" content="otp-credentials=(self 'https://embedded.com')">
    <title>Verify SMS Demo</title>
  </head>

  <body>
    <div style="text-align: center;">
    <h1 style="background-color: blueviolet; color: aliceblue; text-align: center;">OTP Autofill Verification</h1>

    <form action="/next.html" method="get">
        Enter OTP here2:
        <input type="text" autocomplete="one-time-code" name="one-time-code" style="height: 30px" required/>
        <br><br>
        <input type="submit" value="Submit">
        <!-- <iframe src="https://embedded.com/..." allow="otp-credentials"> ... </iframe> -->
    </form>
<script>
  if ("OTPCredential" in window) {
    window.addEventListener("DOMContentLoaded", (e) => {
      console.log("dom loaded");
      const input = document.querySelector('input[autocomplete="one-time-code"]');
       if (!input) return;
        // Set up an AbortController to use with the OTP request
       const ac = new AbortController();
       const form = input.closest("form");
      if (form) {
        // Abort the OTP request if the user attempts to submit the form manually
        form.addEventListener("submit", (e) => {
          ac.abort();
        });
      }
      // Request the OTP via get()
      navigator.credentials
        .get({
          otp: { transport: ["sms"] },
          signal: ac.signal,
          console.log("otp sms received")
        })
        .then((otp) => {
          // When the OTP is received by the app client, enter it into the form
          // input and submit the form automatically
          input.value = otp.code;
          console.log("otp code block executed");
          if (form) form.submit();
        })
        .catch((err) => {
          console.error(err);
        });
    });
  }
</script>
   
  </div>
  </body>
  
</html>

